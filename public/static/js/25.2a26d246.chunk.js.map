{"version":3,"sources":["screens/authenticated/dropzones/UpdateDropzoneScreen.tsx"],"names":["QUERY_DROPZONE_DETAILS","gql","MUTATION_UPDATE_DROPZONE","UpdateDropzoneScreen","state","useAppSelector","forms","dropzone","globalState","global","dispatch","useAppDispatch","useRoute","params","navigation","useNavigation","useQuery","variables","dropzoneId","Number","id","data","loading","React","actions","setOpen","useMutation","mutationUpdateDropzone","mutation","onSave","a","async","hasError","fields","name","banner","federation","primaryColor","secondaryColor","isCreditSystemEnabled","isPublic","value","length","setFieldError","federationId","result","updateDropzone","fieldErrors","map","field","message","errors","notifications","showSnackbar","variant","setDropzone","currentDropzone","goBack","JSON","stringify","indeterminate","color","theme","colors","accent","visible","style","backgroundColor","contentContainerStyle","styles","content","icon","mode","disabled","onPress","StyleSheet","create","container","flex","display","flexGrow","alignItems","padding","title","fontSize","fontWeight","separator","marginVertical","height","width","marginBottom"],"mappings":"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","file":"static/js/25.2a26d246.chunk.js","sourcesContent":["import * as React from 'react';\nimport { StyleSheet } from 'react-native';\nimport { Button, IconButton, ProgressBar } from 'react-native-paper';\nimport { gql, useMutation, useQuery } from \"@apollo/client\";\nimport { actions, useAppSelector, useAppDispatch } from '../../../redux';\n\nimport { View } from '../../../components/Themed';\nimport { Dropzone, Mutation, Query } from '../../../graphql/schema';\nimport DropzoneForm from '../../../components/forms/dropzone/DropzoneForm';\nimport { useNavigation, useRoute } from '@react-navigation/core';\nimport ScrollableScreen from '../../../components/layout/ScrollableScreen';\n\n\nconst QUERY_DROPZONE_DETAILS = gql`\n  query QueryDropzoneDetails($dropzoneId: Int!) {\n    dropzone(id: $dropzoneId) {\n      id\n      name\n      primaryColor,\n      secondaryColor,\n      planes {\n        id\n        name\n        registration\n      }\n      ticketTypes {\n        id\n        name\n      }\n    }\n  }\n`;\n\n\nconst MUTATION_UPDATE_DROPZONE = gql`\n  mutation UpdateDropzone(\n    $id: Int!,\n    $name: String!,\n    $banner: String,\n    $federationId: Int!\n    $primaryColor: String\n    $secondaryColor: String\n    $isCreditSystemEnabled: Boolean,\n    $isPublic: Boolean\n  ){\n    updateDropzone(input: {\n      id: $id\n      attributes: {\n        name: $name,\n        banner: $banner,\n        federationId: $federationId\n        primaryColor: $primaryColor\n        secondaryColor: $secondaryColor\n        isCreditSystemEnabled: $isCreditSystemEnabled\n        isPublic: $isPublic\n      }\n    }) {\n      dropzone {\n        id\n        name\n        banner\n        primaryColor\n        secondaryColor,\n        isCreditSystemEnabled\n\n        planes {\n          id\n          name\n        }\n\n        federation {\n          id\n          name\n        }\n      }\n    }\n  }\n`;\n\nexport default function UpdateDropzoneScreen() {\n  const state = useAppSelector(state => state.forms.dropzone);\n  const globalState = useAppSelector(state => state.global);\n  const dispatch = useAppDispatch();\n\n  const route = useRoute<{ key: string, name: string, params: { dropzone: Dropzone }}>();\n  const dropzone = route.params!.dropzone;\n  const navigation = useNavigation();\n\n  const { data, loading } = useQuery<Query>(QUERY_DROPZONE_DETAILS, {\n    variables: { dropzoneId: Number(dropzone.id)}\n  });\n\n  React.useEffect(() => {\n    if (data?.dropzone?.id) {\n      dispatch(actions.forms.dropzone.setOpen(data.dropzone));\n    }\n  }, [data?.dropzone?.id]);\n\n  const [mutationUpdateDropzone, mutation] = useMutation<Mutation>(MUTATION_UPDATE_DROPZONE);\n\n  const onSave = React.useCallback(async () => {\n    let hasError = false;\n    const { name, banner, federation, primaryColor, secondaryColor, isCreditSystemEnabled, isPublic } = state.fields;\n\n    if (!name.value?.length || name.value?.length < 3) {\n      hasError = true;\n      dispatch(\n        actions.forms.dropzone.setFieldError([\"name\", \"Name is too short\"])\n      );\n    }\n\n    if (!hasError) {\n      try {\n        const result = await mutationUpdateDropzone({\n          variables: {\n            id: Number(dropzone?.id),\n            name: name.value,\n            banner: banner.value || null,\n            primaryColor: primaryColor.value,\n            secondaryColor: secondaryColor.value,\n            federationId: Number(federation?.value?.id),\n            isCreditSystemEnabled: !!isCreditSystemEnabled,\n            isPublic: !!isPublic\n          }\n        });\n\n        result?.data?.updateDropzone?.fieldErrors?.map(({ field, message }) => {\n          switch (field) {\n            case \"federation\":\n            case \"federation_id\":\n              return dispatch(actions.forms.dropzone.setFieldError([\"federation\", message]));\n            case \"banner\":\n              return dispatch(actions.forms.dropzone.setFieldError([\"banner\", message]));\n            case \"primary_color\":\n              return dispatch(actions.forms.dropzone.setFieldError([\"primaryColor\", message]));\n            case \"secondary_color\":\n              return dispatch(actions.forms.dropzone.setFieldError([\"secondaryColor\", message]));\n            case \"is_credit_system_enabled\":\n              return dispatch(actions.forms.dropzone.setFieldError([\"isCreditSystemEnabled\", message]));\n            case \"name\":\n              return dispatch(actions.forms.dropzone.setFieldError([\"name\", message]));\n            case \"is_public\":\n              return dispatch(actions.forms.dropzone.setFieldError([\"isPublic\", message]));\n          }\n        });\n        if (result?.data?.updateDropzone?.errors?.length) {\n          return dispatch(actions.notifications.showSnackbar({\n            message: result?.data?.updateDropzone?.errors[0],\n            variant: \"error\"\n          }));\n        } else if (!result?.data?.updateDropzone?.fieldErrors?.length) {\n          // No errors:\n          if (result.data?.updateDropzone?.dropzone) {\n            dispatch(\n              actions.global.setDropzone({\n                ...(globalState.currentDropzone || {}),\n                ...result?.data?.updateDropzone?.dropzone,\n              })\n            );\n            dispatch(\n              actions.notifications.showSnackbar({ message: `Saved`, variant: \"success\" })\n            );\n            navigation.goBack();\n          }\n        }\n      } catch (error) {\n        dispatch(\n          actions.notifications.showSnackbar({ message: error.message, variant: \"error\" })\n        );\n      }\n    }\n    \n  }, [JSON.stringify(state.fields), dispatch, mutationUpdateDropzone]);\n\n  return (\n    <>\n      <ProgressBar indeterminate color={globalState.theme.colors.accent} visible={loading} />\n      <ScrollableScreen style={{ backgroundColor: globalState.theme.colors.accent }} contentContainerStyle={styles.content}>\n        <IconButton\n          icon=\"wizard\"\n        />\n        <DropzoneForm />\n        <View style={styles.fields}>\n          <Button mode=\"contained\" disabled={mutation.loading} onPress={onSave} loading={mutation.loading}>\n            Save\n          </Button>\n        </View>\n      </ScrollableScreen>\n    </>\n  );\n}\n\nconst styles = StyleSheet.create({\n  container: {\n    flex: 1,\n    backgroundColor: \"white\",\n    display: \"flex\",\n  },\n  content: {\n    display: \"flex\",\n    flexGrow: 1,\n    alignItems: 'center',\n    padding: 48,\n  },\n  title: {\n    fontSize: 20,\n    fontWeight: 'bold',\n  },\n  separator: {\n    marginVertical: 30,\n    height: 1,\n    width: '80%',\n  },\n  fields: {\n    width: \"100%\",\n    marginBottom: 16,\n  },\n  field: {\n    marginBottom: 8,\n  }\n});\n"],"sourceRoot":""}