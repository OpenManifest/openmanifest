(this.webpackJsonp=this.webpackJsonp||[]).push([[22],{545:function(e,n,t){"use strict";t.d(n,"a",(function(){return d}));var i=t(11),r=t.n(i),o=t(0),a=t(178),l=t(50),c=t(552),s=t.n(c),u=(t(553),t(550));function d(e){var n=o.useState(!1),t=r()(n,2),i=t[0],c=t[1];o.useCallback((function(){c(!1)}),[c]),o.useCallback((function(n){var t=n.date;c(!1),e.onChange(t.getTime()/1e3)}),[c,e.onChange]);return o.createElement(o.Fragment,null,o.createElement(a.a,{onDismiss:function(){return c(!1)},visible:i,anchor:o.createElement(l.b.Item,{onPress:function(){return c(!0)},disabled:!!e.disabled,title:e.label,description:e.timestamp?Object(u.a)(1e3*e.timestamp,"yyyy/MM/dd"):"No date selected",left:function(){return o.createElement(l.b.Icon,{icon:"calendar"})}})},o.createElement(s.a,{selectedDays:e.timestamp?[new Date(1e3*e.timestamp)]:[],onDayClick:function(n){e.onChange(n.getTime()/1e3),c(!1)}})))}},570:function(e,n,t){"use strict";t.d(n,"a",(function(){return b}));var i=t(3),r=t.n(i),o=t(0),a=t(2),l=t(268),c=t(240),s=t(50),u=t(242),d=t(98),p=t(97),f=t(545);function m(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,i)}return t}function g(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?m(Object(t),!0).forEach((function(n){r()(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):m(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function b(e){var n,t,i,r,m,b,v,y,I=Object(p.a)(d.a.ActAsRigInspector);return null!=(n=e.config)&&n.valueType&&"string"===(null==(t=e.config)?void 0:t.valueType)?o.createElement(a.a,{style:{flex:1}},o.createElement(l.a,{mode:"outlined",disabled:!I,style:{marginVertical:8},value:e.value,onChangeText:function(n){return e.onChange(g(g({},e.config),{},{value:n}))},label:e.config.label||""}),o.createElement(c.a,{type:"info"},e.config.description||"No description")):null!=(i=e.config)&&i.valueType&&"boolean"===(null==(r=e.config)?void 0:r.valueType)?o.createElement(s.b.Item,{title:e.config.label||"",disabled:!I,description:e.config.description,style:{marginVertical:8},right:function(){return o.createElement(u.a.Android,{status:e.value?"checked":"unchecked"})},onPress:function(){return e.onChange(g(g({},e.config),{},{value:!e.value}))}}):null!=(m=e.config)&&m.valueType&&"integer"===(null==(b=e.config)?void 0:b.valueType)?o.createElement(a.a,{style:{flex:1}},o.createElement(l.a,{disabled:!I,value:e.value,mode:"outlined",onChangeText:function(n){return e.onChange(g(g({},e.config),{},{value:n}))},label:e.config.label||"",keyboardType:"number-pad",style:{marginVertical:8}}),o.createElement(c.a,{type:"info"},e.config.description||"No description")):null!=(v=e.config)&&v.valueType&&"date"===(null==(y=e.config)?void 0:y.valueType)?o.createElement(a.a,{style:{flex:1}},o.createElement(f.a,{disabled:!I,timestamp:Number(e.value),onChange:function(n){return e.onChange(g(g({},e.config),{},{value:n.toString()}))},label:e.config.label||""}),o.createElement(c.a,{type:"info"},e.config.description||"No description")):null}},726:function(e,n,t){"use strict";t.r(n),t.d(n,"default",(function(){return N}));var i=t(11),r=t.n(i),o=t(57),a=t.n(o),l=t(6),c=t.n(l),s=t(51),u=t(40),d=t(550),p=t(58),f=t(0),m=t(105),g=t(50),b=t(323),v=t(242),y=t(125),I=t(19),O=t(570);function E(){var e=Object(I.c)((function(e){return e.forms.rigInspection})),n=Object(I.b)();return f.createElement(f.Fragment,null,e.fields.map((function(e,t){return f.createElement(O.a,{config:e,value:(null==e?void 0:e.value)||"",onChange:function(e){return n(I.a.forms.rigInspection.setField([t,e]))}})})))}var k,h,j=t(183),z=t(278),T=t(98),C=t(97),w=Object(p.a)(k||(k=a()(["\n  query RigInspections($dropzoneUserId: Int!, $dropzoneId: Int!) {\n    dropzone(id: $dropzoneId) {\n      id\n\n      rigInspectionTemplate {\n        id\n        name\n        definition\n      }\n\n      dropzoneUser(id: $dropzoneUserId) {\n        id\n        rigInspections {\n          id\n          isOk\n          definition\n          rig {\n            id\n          }\n          inspectedBy {\n            id\n            name\n          }\n          formTemplate {\n            id\n            name\n            definition\n          }\n        }\n      }\n    }\n  }\n"]))),S=Object(p.a)(h||(h=a()(["\n  mutation CreateRigInspection(\n    $dropzoneId: Int,\n    $rigId: Int,\n    $isOk: Boolean,\n    $definition: String,\n  ) {\n    createRigInspection(input: {\n      attributes: {\n        dropzoneId: $dropzoneId,\n        rigId: $rigId,\n        isOk: $isOk,\n        definition: $definition,\n      }\n    }) {\n      rigInspection {\n        id\n        isOk\n        definition\n        inspectedBy {\n          id\n          name\n        }\n        rig {\n          id\n        }\n        \n        formTemplate {\n          id\n          definition\n        }\n      }\n      fieldErrors {\n        field\n        message\n      }\n      errors\n    }\n  }\n"])));function N(){var e,n,t,i,o,a,l,p,O,k,h=Object(I.c)((function(e){return e.forms.rigInspection})),N=Object(z.a)(),P=Object(I.b)(),$=Object(u.useRoute)().params,x=$.rig,R=$.dropzoneUserId,A=Object(s.useQuery)(w,{variables:{dropzoneId:Number(null==N||null==(e=N.dropzone)?void 0:e.id),dropzoneUserId:R}}),D=A.data,M=(A.loading,A.refetch),U=Object(u.useIsFocused)();f.useEffect((function(){M()}),[U]);var F=Object(C.a)(T.a.ActAsRigInspector),J=Object(s.useMutation)(S),B=r()(J,2),V=B[0],q=B[1],K=Object(u.useNavigation)();f.useEffect((function(){var e,n,t;if(null==D||null==(e=D.dropzone)||null==(n=e.dropzoneUser)||null==(t=n.rigInspections)?void 0:t.some((function(e){var n;return(null==(n=e.rig)?void 0:n.id.toString())===x.id.toString()&&e.definition}))){var i,r,o,a=null==D||null==(i=D.dropzone)||null==(r=i.dropzoneUser)||null==(o=r.rigInspections)?void 0:o.find((function(e){var n;return(null==(n=e.rig)?void 0:n.id)===x.id}));P(I.a.forms.rigInspection.setFields(a.definition||"")),P(I.a.forms.rigInspection.setOk(a.isOk))}else{var l;P(I.a.forms.rigInspection.setFields(null==D||null==(l=D.dropzone.rigInspectionTemplate)?void 0:l.definition))}}),[JSON.stringify(null==D||null==(n=D.dropzone)||null==(t=n.dropzoneUser)?void 0:t.rigInspections),null==D||null==(i=D.dropzone)||null==(o=i.rigInspectionTemplate)?void 0:o.definition]);var Q=f.useCallback((function(){var e;return c.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,c.a.awrap(V({variables:{dropzoneId:Number(null==N||null==(e=N.dropzone)?void 0:e.id),rigId:Number(x.id),definition:JSON.stringify(h.fields),isOk:!!h.ok}}));case 3:n.sent,P(I.a.notifications.showSnackbar({message:"Rig inspection saved",variant:"success"})),P(I.a.forms.rigInspection.reset()),K.goBack(),n.next=12;break;case 9:n.prev=9,n.t0=n.catch(0),P(I.a.notifications.showSnackbar({message:n.t0.message,variant:"error"}));case 12:case"end":return n.stop()}}),null,null,[[0,9]],Promise)}),[JSON.stringify(h.fields),h.ok,null==N||null==(a=N.dropzone)?void 0:a.id]);return f.createElement(j.a,null,f.createElement(m.a,{style:{width:"100%",marginVertical:16}},f.createElement(m.a.Title,{title:"Rig"}),f.createElement(m.a.Content,null,f.createElement(g.b.Item,{title:"Make",description:x.make}),f.createElement(g.b.Item,{title:"Model",description:x.model}),f.createElement(g.b.Item,{title:"Serial",description:x.serial}),f.createElement(g.b.Item,{title:"Repack due",description:null!=x&&x.repackExpiresAt?Object(d.a)(1e3*x.repackExpiresAt,"yyyy/MM/dd"):"-"}))),f.createElement(m.a,{style:{width:"100%"}},f.createElement(m.a.Title,{title:null==D||null==(l=D.dropzone)||null==(p=l.rigInspectionTemplate)?void 0:p.name}),f.createElement(m.a.Content,null,f.createElement(E,null),f.createElement(b.a,null),f.createElement(v.a.Item,{mode:"android",label:"This rig is OK to jump",onPress:function(){return P(I.a.forms.rigInspection.setOk(!h.ok))},status:h.ok?"checked":"unchecked"})),f.createElement(m.a.Actions,null,f.createElement(y.a,{disabled:!F||JSON.stringify(h.fields)===(null==D||null==(O=D.dropzone)||null==(k=O.rigInspectionTemplate)?void 0:k.definition),mode:"contained",onPress:function(){return Q()},loading:q.loading,style:{width:"100%"}},"Mark as inspected"))))}}}]);
//# sourceMappingURL=22.c27df86f.chunk.js.map