(this.webpackJsonp=this.webpackJsonp||[]).push([[14],{633:function(e,n,t){"use strict";t.d(n,"a",(function(){return c}));var r=t(0),o=t(1),l=t(97),i=t(255),a=t(405),s=t(398),u=t(207),d=t(5);function c(e){var n=e.buttonLabel,t=e.buttonAction,o=e.title,c=e.loading,m=e.children,f=Object(d.c)((function(e){return e.global}));return r.createElement(i.a,null,r.createElement(a.a,{visible:!!e.open,dismissable:!1,style:{maxWidth:500,alignSelf:"center"}},r.createElement(s.a,{indeterminate:!0,visible:c,color:f.theme.colors.accent}),r.createElement(a.a.Title,null,o),r.createElement(a.a.Content,{pointerEvents:"box-none"},r.createElement(a.a.ScrollArea,null,r.createElement(l.b,null,m))),r.createElement(a.a.Actions,{style:{justifyContent:"flex-end"}},r.createElement(u.a,{onPress:function(){e.onClose()}},"Cancel"),r.createElement(u.a,{onPress:t},n))))}o.a.create({button:{width:"100%",borderRadius:16,padding:5},contentContainer:{paddingHorizontal:16,paddingBottom:32},sheet:{elevation:3,backgroundColor:"white",flexGrow:1,height:"100%",display:"flex",flexDirection:"column",justifyContent:"center"},sheetHeader:{elevation:2,borderTopLeftRadius:20,borderTopRightRadius:20,height:40,shadowColor:"#000",shadowOffset:{width:0,height:-4},backgroundColor:"white",shadowOpacity:.22,shadowRadius:2.22}})},639:function(e,n,t){"use strict";t.d(n,"a",(function(){return p})),t.d(n,"b",(function(){return g}));var r,o=t(4),l=t.n(o),i=t(29),a=t.n(i),s=t(38),u=t(37),d=t(5),c=t(163);function m(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function f(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?m(Object(t),!0).forEach((function(n){l()(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):m(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}var p=Object(u.a)(r||(r=a()(["\n  query QueryDropzoneUser($dropzoneId: Int!, $dropzoneUserId: Int!) {\n    dropzone(id: $dropzoneId) {\n      id\n      name\n\n      dropzoneUser(id: $dropzoneUserId) {\n        id\n        credits\n        expiresAt\n        permissions\n\n        role {\n          id\n          name\n        }\n        rigInspections {\n          id\n          isOk\n          rig {\n            id\n          }\n        }\n\n        notifications {\n          edges {\n            node {\n              id\n              message\n              notificationType\n              createdAt\n            }\n          }\n        }\n\n\n        transactions {\n          edges {\n            node {\n              id\n              status\n              message\n              amount\n              createdAt\n            }\n          }\n        }\n        user {\n          id\n          name\n          exitWeight\n          email\n          phone\n          image\n          rigs {\n            id\n            model\n            make\n            serial\n            canopySize\n            repackExpiresAt\n          }\n          jumpTypes {\n            id\n            name\n          }\n          license {\n            id\n            name\n            federation {\n              id\n              name\n            }\n          }\n        }\n      }\n    }\n  }\n"])));function g(e){var n,t,r,o,l,i,a,u,m,g,b=Object(d.c)((function(e){return e.global.currentDropzoneId})),h=Object(c.b)(),v=Object(s.useQuery)(p,{variables:{dropzoneId:b,dropzoneUserId:e||Number(null==h||null==(n=h.data)||null==(t=n.dropzone)||null==(r=t.currentUser)?void 0:r.id)}});return f(f({},v),{},{dropzoneUser:e&&e!==Number(null==h||null==(o=h.data)||null==(l=o.dropzone)||null==(i=l.currentUser)?void 0:i.id)?null==v||null==(m=v.data)||null==(g=m.dropzone)?void 0:g.dropzoneUser:null==h||null==(a=h.data)||null==(u=a.dropzone)?void 0:u.currentUser})}},654:function(e,n,t){"use strict";t.d(n,"a",(function(){return b}));var r,o=t(9),l=t.n(o),i=t(29),a=t.n(i),s=t(38),u=t(37),d=t(0),c=t(21),m=t(109),f=t(639),p=t(5),g=Object(u.a)(r||(r=a()(["\n  query RolesQuery($dropzoneId: Int!) {\n    dropzone(id: $dropzoneId) {\n      id\n      roles(selectable: true) {\n        id\n        name\n      }\n    }\n  }\n"])));function b(e){var n,t,r,o,i,a=d.useState(!1),u=l()(a,2),b=u[0],h=u[1],v=Object(p.c)((function(e){return e.global})).currentDropzoneId,E=(Object(f.b)().dropzoneUser,Object(s.useQuery)(g,{variables:{dropzoneId:Number(v)}})),y=E.data;E.loading,E.refetch;return d.createElement(d.Fragment,null,d.createElement(c.b.Subheader,{style:{paddingLeft:0}},"Access level"),d.createElement(m.a,{onDismiss:function(){return h(!1)},visible:!e.disabled&&b,anchor:d.createElement(c.b.Item,{left:function(){return d.createElement(c.b.Icon,{icon:"lock"})},onPress:e.disabled?void 0:function(){h(!0)},title:(null==(n=e.value)||null==(t=n.name)||null==(r=t.replace("_"," "))?void 0:r.toUpperCase())||"Access level",description:e.required?null:"Optional"})},null==y||null==(o=y.dropzone)||null==(i=o.roles)?void 0:i.map((function(n){var t;return d.createElement(m.a.Item,{onPress:function(){h(!1),e.onSelect(n)},title:(null==(t=n.name)?void 0:t.replace("_"," ").toUpperCase())||"-"})}))))}},803:function(e,n,t){"use strict";t.r(n),t.d(n,"default",(function(){return T}));var r=t(29),o=t.n(r),l=t(38),i=t(52),a=t(37),s=t(0),u=t(166),d=t(1),c=t(2),m=t(398),f=t(21),p=t(374),g=t(406),b=t(331),h=t(33),v=t(5),E=t(46),y=t(6),O=t.n(y),I=t(287),j=t(285),z=t(336),x=t(168),S=t(654);function w(){var e,n,t,r,o,l,i,a,u,d,m,f,g,b,h,E,y,O,w,C,$,k,U,W=Object(v.c)((function(e){return e.forms.ghost})),F=Object(v.b)();return s.useEffect((function(){if(W.original){var e,n,t;if(!W.fields.exitWeight.value)F(v.a.forms.ghost.setField(["exitWeight",(null==(t=W.original.exitWeight)?void 0:t.toString())||"60"]));!W.fields.license.value&&null!=(e=W.original)&&null!=(n=e.license)&&n.id&&(F(v.a.forms.ghost.setFederation(W.original.license.federation)),F(v.a.forms.ghost.setField(["license",W.original.license])))}}),[null==(e=W.original)?void 0:e.id]),s.createElement(s.Fragment,null,s.createElement(I.a,{style:P.field,mode:"outlined",label:"Name",error:!!W.fields.name.error,value:(null==(n=W.fields.name)||null==(t=n.value)?void 0:t.toString())||"",onChangeText:function(e){return F(v.a.forms.ghost.setField(["name",e]))}}),s.createElement(j.a,{type:W.fields.name.error?"error":"info"},W.fields.name.error||" "),s.createElement(I.a,{style:P.field,mode:"outlined",label:"Email",error:!!W.fields.email.error,value:(null==(r=W.fields.email)||null==(o=r.value)?void 0:o.toString())||"",onChangeText:function(e){return F(v.a.forms.ghost.setField(["email",e]))}}),s.createElement(j.a,{type:W.fields.email.error?"error":"info"},W.fields.email.error||" "),s.createElement(I.a,{style:P.field,mode:"outlined",label:"Exit weight",error:!!W.fields.exitWeight.error,value:(null==(l=W.fields.exitWeight)||null==(i=l.value)?void 0:i.toString())||"",keyboardType:"numbers-and-punctuation",right:function(){return s.createElement(I.a.Affix,{text:"kg"})},onChangeText:function(e){return F(v.a.forms.ghost.setField(["exitWeight",e]))}}),s.createElement(j.a,{type:W.fields.exitWeight.error?"error":"info"},W.fields.exitWeight.error||""),s.createElement(p.a,null),s.createElement(c.a,{style:{width:"100%"}},s.createElement(x.a,{value:(null==W||null==(a=W.fields)||null==(u=a.license)||null==(d=u.value)?void 0:d.federation)||W.federation.value,onSelect:function(e){return F(v.a.forms.ghost.setFederation(e))},required:!0}),s.createElement(j.a,{type:W.federation.error?"error":"info"},W.federation.error||""),((null==W||null==(m=W.fields)||null==(f=m.license)||null==(g=f.value)||null==(b=g.federation)?void 0:b.id)||(null==W||null==(h=W.federation)||null==(E=h.value)?void 0:E.id))&&s.createElement(s.Fragment,null,s.createElement(z.a,{value:W.fields.license.value,federationId:Number((null==W||null==(y=W.fields)||null==(O=y.license)||null==(w=O.value)||null==(C=w.federation)?void 0:C.id)||(null==($=W.federation)||null==(k=$.value)?void 0:k.id)),onSelect:function(e){return F(v.a.forms.ghost.setField(["license",e]))},required:!0}),s.createElement(j.a,{type:W.fields.license.error?"error":"info"},W.fields.license.error||""))),s.createElement(S.a,{style:P.field,mode:"outlined",label:"Role",error:!!W.fields.role.error,value:(null==(U=W.fields.role)?void 0:U.value)||"",onSelect:function(e){return F(v.a.forms.ghost.setField(["role",e]))},required:!0}),s.createElement(j.a,{type:W.fields.phone.error?"error":"info"},W.fields.phone.error||""))}var C,P=d.a.create({fields:{flex:1,width:"100%",paddingTop:32},field:{marginBottom:8,width:"100%"},ticketAddons:{marginBottom:8}}),$=t(633),k=t(50),U=Object(a.a)(C||(C=o()(["\n  mutation CreateGhost(\n    $name: String!,\n    $phone: String,\n    $email: String!,\n    $roleId: Int!,\n    $licenseId: Int,\n    $dropzoneId: Int!\n    $exitWeight: Float!,\n  ){\n    createGhost(input: {\n      attributes: {\n        roleId: $roleId,\n        name: $name,\n        phone: $phone,\n        email: $email,\n        dropzoneId: $dropzoneId,\n        licenseId: $licenseId,\n        exitWeight: $exitWeight,\n      }\n    }) {\n      errors\n      fieldErrors {\n        field\n        message\n      }\n      user {\n        id\n        name\n        exitWeight\n        email\n        phone\n        \n        jumpTypes {\n          id\n          name\n        }\n        license {\n          id\n          name\n\n          federation {\n            id\n            name\n          }\n        }\n      }\n    }\n  }\n"]))),W=Object(k.a)(U,{getPayload:function(e){return e.createGhost},validates:{exitWeight:[Object(k.d)("Exit weight must be provided"),Object(k.c)("Please enter a valid number")],email:[Object(k.d)("Please provide a valid email address"),Object(k.b)("Please provide a valid email address")],name:[Object(k.d)("Name is required")],roleId:[Object(k.d)("You must select a role")]},fieldErrorMap:{license:"licenseId",exit_weight:"exitWeight",role:"roleId"}});function F(e){var n=e.open,t=e.onSuccess,r=Object(v.c)((function(e){return e.forms.ghost})),o=Object(v.c)((function(e){return e.global})),l=Object(v.b)(),i=W({onSuccess:function(e){},onFieldError:function(e,n){l(v.a.forms.ghost.setFieldError([e,n])),console.log(e,n)},onError:function(e){return l(v.a.notifications.showSnackbar({message:e,variant:"error"}))}}),a=s.useCallback((function(){var e,n,a,s,u,d,c,m;return O.a.async((function(f){for(;;)switch(f.prev=f.next){case 0:return e=r.fields,n=e.name,a=e.license,s=e.phone,u=e.email,d=e.exitWeight,c=e.role,f.prev=1,f.next=4,O.a.awrap(i.mutate({dropzoneId:o.currentDropzoneId,name:n.value,licenseId:null!=(m=a.value)&&m.id?Number(a.value.id):null,phone:s.value,exitWeight:Number(d.value),email:u.value,roleId:Number(c.value.id)}));case 4:f.sent,t(),l(v.a.notifications.showSnackbar({message:"Profile has been updated",variant:"success"})),l(v.a.forms.ghost.reset()),f.next=13;break;case 10:f.prev=10,f.t0=f.catch(1),l(v.a.notifications.showSnackbar({message:f.t0.message,variant:"error"}));case 13:case"end":return f.stop()}}),null,null,[[1,10]],Promise)}),[JSON.stringify(r.fields),l,i,n,t]);return s.createElement($.a,{title:"Pre-register user",open:n,snapPoints:[0,400,740],loading:i.loading,onClose:function(){e.onClose()},buttonAction:a,buttonLabel:"Save"},s.createElement(w,null))}var N,A=t(97),D=Object(a.a)(N||(N=o()(["\n  query QueryDropzoneUsersSearch(\n    $dropzoneId: Int!\n    $search: String\n  ) {\n    dropzone(id: $dropzoneId) {\n      id\n      name\n\n      dropzoneUsers(search: $search) {\n        edges {\n          node {\n            id\n            role {\n              id\n              name\n            }\n            user {\n              id\n              image\n              name\n            }\n          }\n        }\n      }\n    }\n  }\n"])));function T(){var e,n,t=Object(v.c)((function(e){return e.global})),r=Object(v.c)((function(e){return e.screens.users})),o=Object(v.c)((function(e){return e.forms.ghost})),a=Object(v.b)(),d=Object(l.useQuery)(D,{variables:{dropzoneId:Number(t.currentDropzoneId),search:r.searchText},fetchPolicy:"network-only"}),y=d.data,O=d.loading,I=d.refetch,j=Object(i.useNavigation)(),z=(Object(i.useRoute)(),Object(i.useIsFocused)());s.useEffect((function(){r.isSearchVisible&&a(v.a.screens.users.setSearchVisible(!1))}),[z]);var x=Object(E.a)(h.b.CreateUser);return s.createElement(s.Fragment,null,s.createElement(m.a,{indeterminate:!0,color:t.theme.colors.accent,visible:O}),s.createElement(A.a,{data:(null==y||null==(e=y.dropzone)||null==(n=e.dropzoneUsers)?void 0:n.edges)||[],onRefresh:function(){return I({dropzoneId:Number(t.currentDropzoneId),search:r.searchText})},refreshing:O,refreshControl:s.createElement(u.a,{refreshing:O,onRefresh:I}),style:{flexGrow:1},ListEmptyComponent:function(){return s.createElement(c.a,{style:{alignSelf:"center",alignItems:"center",justifyContent:"center"}},s.createElement(b.a,{title:"No users",subtitle:""}))},numColumns:1,renderItem:function(e){var n,t,r,o,l,i=e.item;return s.createElement(s.Fragment,{key:"user-"+(null==i||null==(n=i.node)?void 0:n.id)},s.createElement(f.b.Item,{style:{width:"100%"},title:null==i||null==(t=i.node)?void 0:t.user.name,description:null==i||null==(r=i.node)||null==(o=r.role)||null==(l=o.name)?void 0:l.replace("_"," ").toUpperCase(),left:function(){var e,n,t;return null!=i&&null!=(e=i.node)&&null!=(n=e.user)&&n.image?s.createElement(f.a.Image,{source:{uri:null==i||null==(t=i.node)?void 0:t.user.image},style:{alignSelf:"center",marginHorizontal:12},size:32}):s.createElement(f.b.Icon,{icon:"account"})},onPress:function(){var e;return j.navigate("UserProfileScreen",{userId:null==i||null==(e=i.node)?void 0:e.id})}}),s.createElement(p.a,{style:{width:"100%"},key:"divider-"+(null==i?void 0:i.node.id)}))}}),x&&s.createElement(g.a,{style:R.fab,small:!0,icon:"plus",onPress:function(){return a(v.a.forms.ghost.setOpen(!0))},label:"Add user"}),s.createElement(F,{open:o.open,onClose:function(){return a(v.a.forms.ghost.setOpen(!1))},onSuccess:function(){a(v.a.forms.ghost.setOpen(!1)),I()}}))}var R=d.a.create({container:{flex:1},fab:{position:"absolute",margin:16,right:0,bottom:0},title:{fontSize:20,fontWeight:"bold"},separator:{marginVertical:30,height:1,width:"80%"}})}}]);
//# sourceMappingURL=14.6fd2edba.chunk.js.map