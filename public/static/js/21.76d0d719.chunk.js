(this.webpackJsonp=this.webpackJsonp||[]).push([[21],{599:function(e,n,t){"use strict";t.d(n,"a",(function(){return b}));var i=t(3),r=t.n(i),o=t(0),l=t(2),a=t(251),c=t(249),s=t(21),d=t(252),u=t(81),p=t(97),f=t(294);function g(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,i)}return t}function m(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?g(Object(t),!0).forEach((function(n){r()(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):g(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function b(e){var n,t,i,r,g,b,v,I,y=Object(p.a)(u.a.ActAsRigInspector);return null!=(n=e.config)&&n.valueType&&"string"===(null==(t=e.config)?void 0:t.valueType)?o.createElement(l.a,{style:{flex:1}},o.createElement(a.a,{mode:"outlined",disabled:!y,style:{marginVertical:8},value:e.value,onChangeText:function(n){return e.onChange(m(m({},e.config),{},{value:n}))},label:e.config.label||""}),o.createElement(c.a,{type:"info"},e.config.description||"No description")):null!=(i=e.config)&&i.valueType&&"boolean"===(null==(r=e.config)?void 0:r.valueType)?o.createElement(s.b.Item,{title:e.config.label||"",disabled:!y,description:e.config.description,style:{marginVertical:8},right:function(){return o.createElement(d.a.Android,{status:e.value?"checked":"unchecked"})},onPress:function(){return e.onChange(m(m({},e.config),{},{value:!e.value}))}}):null!=(g=e.config)&&g.valueType&&"integer"===(null==(b=e.config)?void 0:b.valueType)?o.createElement(l.a,{style:{flex:1}},o.createElement(a.a,{disabled:!y,value:e.value,mode:"outlined",onChangeText:function(n){return e.onChange(m(m({},e.config),{},{value:n}))},label:e.config.label||"",keyboardType:"number-pad",style:{marginVertical:8}}),o.createElement(c.a,{type:"info"},e.config.description||"No description")):null!=(v=e.config)&&v.valueType&&"date"===(null==(I=e.config)?void 0:I.valueType)?o.createElement(l.a,{style:{flex:1}},o.createElement(f.a,{disabled:!y,timestamp:Number(e.value),onChange:function(n){return e.onChange(m(m({},e.config),{},{value:n.toString()}))},label:e.config.label||""}),o.createElement(c.a,{type:"info"},e.config.description||"No description")):null}},746:function(e,n,t){"use strict";t.r(n),t.d(n,"default",(function(){return N}));var i=t(9),r=t.n(i),o=t(31),l=t.n(o),a=t(4),c=t.n(a),s=t(38),d=t(47),u=t(354),p=t(32),f=t(0),g=t(96),m=t(21),b=t(340),v=t(252),I=t(173),y=t(5),O=t(599);function E(){var e=Object(y.c)((function(e){return e.forms.rigInspection})),n=Object(y.b)();return f.createElement(f.Fragment,null,e.fields.map((function(e,t){return f.createElement(O.a,{config:e,value:(null==e?void 0:e.value)||"",onChange:function(e){return n(y.a.forms.rigInspection.setField([t,e]))}})})))}var k,h,j=t(191),z=t(290),T=t(81),w=t(97),S=Object(p.a)(k||(k=l()(["\n  query RigInspections($dropzoneUserId: Int!, $dropzoneId: Int!) {\n    dropzone(id: $dropzoneId) {\n      id\n\n      rigInspectionTemplate {\n        id\n        name\n        definition\n      }\n\n      dropzoneUser(id: $dropzoneUserId) {\n        id\n        rigInspections {\n          id\n          isOk\n          definition\n          rig {\n            id\n          }\n          inspectedBy {\n            id\n            name\n          }\n          formTemplate {\n            id\n            name\n            definition\n          }\n        }\n      }\n    }\n  }\n"]))),C=Object(p.a)(h||(h=l()(["\n  mutation CreateRigInspection(\n    $dropzoneId: Int,\n    $rigId: Int,\n    $isOk: Boolean,\n    $definition: String,\n  ) {\n    createRigInspection(input: {\n      attributes: {\n        dropzoneId: $dropzoneId,\n        rigId: $rigId,\n        isOk: $isOk,\n        definition: $definition,\n      }\n    }) {\n      rigInspection {\n        id\n        isOk\n        definition\n        inspectedBy {\n          id\n          name\n        }\n        rig {\n          id\n        }\n        \n        formTemplate {\n          id\n          definition\n        }\n      }\n      fieldErrors {\n        field\n        message\n      }\n      errors\n    }\n  }\n"])));function N(){var e,n,t,i,o,l,a,p,O,k,h=Object(y.c)((function(e){return e.forms.rigInspection})),N=Object(z.a)(),P=Object(y.b)(),$=Object(d.useRoute)().params,x=$.rig,R=$.dropzoneUserId,A=Object(s.useQuery)(S,{variables:{dropzoneId:Number(null==N||null==(e=N.dropzone)?void 0:e.id),dropzoneUserId:R}}),U=A.data,J=(A.loading,A.refetch),M=Object(d.useIsFocused)();f.useEffect((function(){J()}),[M]);var F=Object(w.a)(T.a.ActAsRigInspector),B=Object(s.useMutation)(C),D=r()(B,2),V=D[0],q=D[1],K=Object(d.useNavigation)();f.useEffect((function(){var e,n,t;if(null==U||null==(e=U.dropzone)||null==(n=e.dropzoneUser)||null==(t=n.rigInspections)?void 0:t.some((function(e){var n;return(null==(n=e.rig)?void 0:n.id.toString())===x.id.toString()&&e.definition}))){var i,r,o,l=null==U||null==(i=U.dropzone)||null==(r=i.dropzoneUser)||null==(o=r.rigInspections)?void 0:o.find((function(e){var n;return(null==(n=e.rig)?void 0:n.id)===x.id}));P(y.a.forms.rigInspection.setFields(l.definition||"")),P(y.a.forms.rigInspection.setOk(l.isOk))}else{var a;P(y.a.forms.rigInspection.setFields(null==U||null==(a=U.dropzone.rigInspectionTemplate)?void 0:a.definition))}}),[JSON.stringify(null==U||null==(n=U.dropzone)||null==(t=n.dropzoneUser)?void 0:t.rigInspections),null==U||null==(i=U.dropzone)||null==(o=i.rigInspectionTemplate)?void 0:o.definition]);var Q=f.useCallback((function(){var e;return c.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,c.a.awrap(V({variables:{dropzoneId:Number(null==N||null==(e=N.dropzone)?void 0:e.id),rigId:Number(x.id),definition:JSON.stringify(h.fields),isOk:!!h.ok}}));case 3:n.sent,P(y.a.notifications.showSnackbar({message:"Rig inspection saved",variant:"success"})),P(y.a.forms.rigInspection.reset()),K.goBack(),n.next=12;break;case 9:n.prev=9,n.t0=n.catch(0),P(y.a.notifications.showSnackbar({message:n.t0.message,variant:"error"}));case 12:case"end":return n.stop()}}),null,null,[[0,9]],Promise)}),[JSON.stringify(h.fields),h.ok,null==N||null==(l=N.dropzone)?void 0:l.id]);return f.createElement(j.a,null,f.createElement(g.a,{style:{width:"100%",marginVertical:16}},f.createElement(g.a.Title,{title:"Rig"}),f.createElement(g.a.Content,null,f.createElement(m.b.Item,{title:"Make",description:x.make}),f.createElement(m.b.Item,{title:"Model",description:x.model}),f.createElement(m.b.Item,{title:"Serial",description:x.serial}),f.createElement(m.b.Item,{title:"Repack due",description:null!=x&&x.repackExpiresAt?Object(u.a)(1e3*x.repackExpiresAt,"yyyy/MM/dd"):"-"}))),f.createElement(g.a,{style:{width:"100%"}},f.createElement(g.a.Title,{title:null==U||null==(a=U.dropzone)||null==(p=a.rigInspectionTemplate)?void 0:p.name}),f.createElement(g.a.Content,null,f.createElement(E,null),f.createElement(b.a,null),f.createElement(v.a.Item,{mode:"android",label:"This rig is OK to jump",onPress:function(){return P(y.a.forms.rigInspection.setOk(!h.ok))},status:h.ok?"checked":"unchecked"})),f.createElement(g.a.Actions,null,f.createElement(I.a,{disabled:!F||JSON.stringify(h.fields)===(null==U||null==(O=U.dropzone)||null==(k=O.rigInspectionTemplate)?void 0:k.definition),mode:"contained",onPress:function(){return Q()},loading:q.loading,style:{width:"100%"}},"Mark as inspected"))))}}}]);
//# sourceMappingURL=21.76d0d719.chunk.js.map