(this.webpackJsonp=this.webpackJsonp||[]).push([[20],{639:function(e,n,r){"use strict";r.d(n,"a",(function(){return g})),r.d(n,"b",(function(){return m}));var t,i=r(4),o=r.n(i),l=r(29),a=r.n(l),c=r(38),d=r(37),s=r(5),u=r(163);function p(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);n&&(t=t.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),r.push.apply(r,t)}return r}function f(e){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?p(Object(r),!0).forEach((function(n){o()(e,n,r[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):p(Object(r)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))}))}return e}var g=Object(d.a)(t||(t=a()(["\n  query QueryDropzoneUser($dropzoneId: Int!, $dropzoneUserId: Int!) {\n    dropzone(id: $dropzoneId) {\n      id\n      name\n\n      dropzoneUser(id: $dropzoneUserId) {\n        id\n        credits\n        expiresAt\n        permissions\n\n        role {\n          id\n          name\n        }\n        rigInspections {\n          id\n          isOk\n          rig {\n            id\n          }\n        }\n\n        notifications {\n          edges {\n            node {\n              id\n              message\n              notificationType\n              createdAt\n            }\n          }\n        }\n\n\n        transactions {\n          edges {\n            node {\n              id\n              status\n              message\n              amount\n              createdAt\n            }\n          }\n        }\n        user {\n          id\n          name\n          exitWeight\n          email\n          phone\n          image\n          rigs {\n            id\n            model\n            make\n            serial\n            canopySize\n            repackExpiresAt\n          }\n          jumpTypes {\n            id\n            name\n          }\n          license {\n            id\n            name\n            federation {\n              id\n              name\n            }\n          }\n        }\n      }\n    }\n  }\n"])));function m(e){var n,r,t,i,o,l,a,d,p,m,b=Object(s.c)((function(e){return e.global.currentDropzoneId})),v=Object(u.b)(),O=Object(c.useQuery)(g,{variables:{dropzoneId:b,dropzoneUserId:e||Number(null==v||null==(n=v.data)||null==(r=n.dropzone)||null==(t=r.currentUser)?void 0:t.id)}});return f(f({},O),{},{dropzoneUser:e&&e!==Number(null==v||null==(i=v.data)||null==(o=i.dropzone)||null==(l=o.currentUser)?void 0:l.id)?null==O||null==(p=O.data)||null==(m=p.dropzone)?void 0:m.dropzoneUser:null==v||null==(a=v.data)||null==(d=a.dropzone)?void 0:d.currentUser})}},656:function(e,n,r){"use strict";r.d(n,"a",(function(){return b}));var t=r(4),i=r.n(t),o=r(0),l=r(2),a=r(287),c=r(285),d=r(21),s=r(288),u=r(33),p=r(46),f=r(333);function g(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);n&&(t=t.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),r.push.apply(r,t)}return r}function m(e){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?g(Object(r),!0).forEach((function(n){i()(e,n,r[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):g(Object(r)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))}))}return e}function b(e){var n,r,t,i,g,b,v,O,y=Object(p.a)(u.b.ActAsRigInspector);return null!=(n=e.config)&&n.valueType&&"string"===(null==(r=e.config)?void 0:r.valueType)?o.createElement(l.a,{style:{flex:1}},o.createElement(a.a,{mode:"outlined",disabled:!y,style:{marginVertical:8},value:e.value,onChangeText:function(n){return e.onChange(m(m({},e.config),{},{value:n}))},label:e.config.label||""}),o.createElement(c.a,{type:"info"},e.config.description||"No description")):null!=(t=e.config)&&t.valueType&&"boolean"===(null==(i=e.config)?void 0:i.valueType)?o.createElement(d.b.Item,{title:e.config.label||"",disabled:!y,description:e.config.description,style:{marginVertical:8},right:function(){return o.createElement(s.a.Android,{status:e.value?"checked":"unchecked"})},onPress:function(){return e.onChange(m(m({},e.config),{},{value:!e.value}))}}):null!=(g=e.config)&&g.valueType&&"integer"===(null==(b=e.config)?void 0:b.valueType)?o.createElement(l.a,{style:{flex:1}},o.createElement(a.a,{disabled:!y,value:e.value,mode:"outlined",onChangeText:function(n){return e.onChange(m(m({},e.config),{},{value:n}))},label:e.config.label||"",keyboardType:"number-pad",style:{marginVertical:8}}),o.createElement(c.a,{type:"info"},e.config.description||"No description")):null!=(v=e.config)&&v.valueType&&"date"===(null==(O=e.config)?void 0:O.valueType)?o.createElement(l.a,{style:{flex:1}},o.createElement(f.a,{disabled:!y,timestamp:Number(e.value),onChange:function(n){return e.onChange(m(m({},e.config),{},{value:n.toString()}))},label:e.config.label||""}),o.createElement(c.a,{type:"info"},e.config.description||"No description")):null}},808:function(e,n,r){"use strict";r.r(n),r.d(n,"default",(function(){return q}));var t=r(23),i=r.n(t),o=r(4),l=r.n(o),a=r(9),c=r.n(a),d=r(29),s=r.n(d),u=r(6),p=r.n(u),f=r(38),g=r(52),m=r(570),b=r(400),v=r(37),O=r(0),y=r(106),I=r(21),z=r(374),j=r(288),h=r(207),E=r(5),k=r(656);function w(){var e=Object(E.c)((function(e){return e.forms.rigInspection})),n=Object(E.b)();return O.createElement(O.Fragment,null,e.fields.map((function(e,r){return O.createElement(k.a,{key:r,config:e,value:(null==e?void 0:e.value)||"",onChange:function(e){return n(E.a.forms.rigInspection.setField([r,e]))}})})))}var U,P,T=r(164),N=r(163),S=r(33),x=r(46),D=r(639),$=r(141);function C(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);n&&(t=t.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),r.push.apply(r,t)}return r}function R(e){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?C(Object(r),!0).forEach((function(n){l()(e,n,r[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):C(Object(r)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))}))}return e}var A=Object(v.a)(U||(U=s()(["\n  query RigInspections($dropzoneUserId: Int!, $dropzoneId: Int!) {\n    dropzone(id: $dropzoneId) {\n      id\n\n      rigInspectionTemplate {\n        id\n        name\n        definition\n      }\n\n      dropzoneUser(id: $dropzoneUserId) {\n        id\n        rigInspections {\n          id\n          isOk\n          definition\n          rig {\n            id\n          }\n          inspectedBy {\n            id\n            user {\n              id\n              name\n            }\n          }\n          formTemplate {\n            id\n            name\n            definition\n          }\n        }\n      }\n    }\n  }\n"]))),Q=Object(v.a)(P||(P=s()(["\n  mutation CreateRigInspection(\n    $dropzoneId: Int,\n    $rigId: Int,\n    $isOk: Boolean,\n    $definition: String,\n  ) {\n    createRigInspection(input: {\n      attributes: {\n        dropzoneId: $dropzoneId,\n        rigId: $rigId,\n        isOk: $isOk,\n        definition: $definition,\n      }\n    }) {\n      rigInspection {\n        id\n        isOk\n        definition\n        dropzoneUser {\n          id\n          rigInspections {\n            id\n            isOk\n            rig {\n              id\n            }\n            inspectedBy {\n              id\n              user {\n                id\n                name\n              }\n            }\n          }\n        }\n        inspectedBy {\n          id\n          user {\n            id\n            name\n          }\n        }\n        rig {\n          id\n          make\n          model\n        }\n        \n        formTemplate {\n          id\n          definition\n        }\n      }\n      fieldErrors {\n        field\n        message\n      }\n      errors\n    }\n  }\n"])));function q(){var e,n,r,t,o,l,a,d,s,u,v=Object(E.c)((function(e){return e.forms.rigInspection})),k=Object(N.b)(),U=Object(E.b)(),P=Object(g.useRoute)().params,C=P.rig,q=P.dropzoneUserId,J=Object(f.useQuery)(A,{variables:{dropzoneId:Number(null==k||null==(e=k.dropzone)?void 0:e.id),dropzoneUserId:q}}),M=J.data,B=(J.loading,J.refetch),F=Object(g.useIsFocused)();O.useEffect((function(){B()}),[F]);var V=Object(x.a)(S.b.ActAsRigInspector),W=Object(f.useMutation)(Q),G=c()(W,2),K=G[0],H=G[1],L=Object(g.useNavigation)();O.useEffect((function(){var e,n,r;if(null==M||null==(e=M.dropzone)||null==(n=e.dropzoneUser)||null==(r=n.rigInspections)?void 0:r.some((function(e){var n;return(null==(n=e.rig)?void 0:n.id.toString())===C.id.toString()&&e.definition}))){var t,i,o,l=null==M||null==(t=M.dropzone)||null==(i=t.dropzoneUser)||null==(o=i.rigInspections)?void 0:o.find((function(e){var n;return(null==(n=e.rig)?void 0:n.id)===C.id}));U(E.a.forms.rigInspection.setFields(l.definition||"{}")),U(E.a.forms.rigInspection.setOk(l.isOk))}else{var a;U(E.a.forms.rigInspection.setFields((null==M||null==(a=M.dropzone.rigInspectionTemplate)?void 0:a.definition)||"[]"))}}),[JSON.stringify(null==M||null==(n=M.dropzone)||null==(r=n.dropzoneUser)?void 0:r.rigInspections),null==M||null==(t=M.dropzone)||null==(o=t.rigInspectionTemplate)?void 0:o.definition]);var X=O.useCallback((function(){var e;return p.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,p.a.awrap(K({variables:{dropzoneId:Number(null==k||null==(e=k.dropzone)?void 0:e.id),rigId:Number(C.id),definition:JSON.stringify(v.fields),isOk:!!v.ok},update:function(e,n){var r,t,o,l,a,c,d,s,u,f,g,b,v,O,y,I,z,j,h,E,w,U,P;return p.a.async((function(p){for(;;)switch(p.prev=p.next){case 0:return O=n.data,y=null==O?void 0:O.createRigInspection,I=y.rigInspection,z=e.readQuery({query:D.a,variables:{dropzoneId:Number(null==k||null==(r=k.dropzone)?void 0:r.id),dropzoneUserId:Number(null==I||null==(t=I.dropzoneUser)?void 0:t.id)}}),(null==(j=e.readQuery({query:N.a,variables:{dropzoneId:Number(null==k||null==(o=k.dropzone)?void 0:o.id),earliestTimestamp:Object(m.a)(new Date).getTime()/1e3}}))||null==(l=j.dropzone)||null==(a=l.currentUser)?void 0:a.id)===(null==I||null==(c=I.dropzoneUser)?void 0:c.id)&&e.writeQuery({query:N.a,variables:{dropzoneId:Number(null==k||null==(h=k.dropzone)?void 0:h.id),earliestTimestamp:Object(m.a)(new Date).getTime()/1e3},data:R(R({},j),{},{dropzone:R(R({},null==j?void 0:j.dropzone),{},{currentUser:R(R({},null==j||null==(E=j.dropzone)?void 0:E.currentUser),{},{rigInspections:[].concat(i()(((null==(w=j.dropzone)||null==(U=w.currentUser)?void 0:U.rigInspections)||[]).filter((function(e){var n,r;return e.id!==(null==O||null==(n=O.createRigInspection)||null==(r=n.rigInspection)?void 0:r.id)}))),[I])})})})}),P=R(R({},z.dropzone),{},{dropzoneUser:R(R({},null==(d=z.dropzone)?void 0:d.dropzoneUser),{},{rigInspections:[].concat(i()(((null==(s=z.dropzone)||null==(u=s.dropzoneUser)?void 0:u.rigInspections)||[]).filter((function(e){var n,r;return e.id!==(null==O||null==(n=O.createRigInspection)||null==(r=n.rigInspection)?void 0:r.id)}))),[I])})}),e.writeQuery({query:D.a,variables:{dropzoneId:Number(null==k||null==(f=k.dropzone)?void 0:f.id),dropzoneUserId:Number(null==O||null==(g=O.createRigInspection)||null==(b=g.rigInspection)||null==(v=b.dropzoneUser)?void 0:v.id)},data:P}),p.abrupt("return",{data:P});case 8:case"end":return p.stop()}}),null,null,null,Promise)}}));case 3:n.sent,U(E.a.notifications.showSnackbar({message:"Rig inspection saved",variant:"success"})),U(E.a.forms.rigInspection.reset()),L.goBack(),n.next=12;break;case 9:n.prev=9,n.t0=n.catch(0),U(E.a.notifications.showSnackbar({message:n.t0.message,variant:"error"}));case 12:case"end":return n.stop()}}),null,null,[[0,9]],Promise)}),[JSON.stringify(v.fields),v.ok,null==k||null==(l=k.dropzone)?void 0:l.id]);return O.createElement(T.a,null,O.createElement($.a,{behavior:"position",style:{width:"100%",flexGrow:1,maxWidth:400,backgroundColor:"transparent"}},O.createElement(y.a,{style:{width:"100%",marginVertical:16}},O.createElement(y.a.Title,{title:"Rig"}),O.createElement(y.a.Content,null,O.createElement(I.b.Item,{title:"Make",description:C.make}),O.createElement(I.b.Item,{title:"Model",description:C.model}),O.createElement(I.b.Item,{title:"Serial",description:C.serial}),O.createElement(I.b.Item,{title:"Repack due",description:null!=C&&C.repackExpiresAt?Object(b.a)(1e3*C.repackExpiresAt,"yyyy/MM/dd"):"-"}))),O.createElement(y.a,{style:{width:"100%"}},O.createElement(y.a.Title,{title:null==M||null==(a=M.dropzone)||null==(d=a.rigInspectionTemplate)?void 0:d.name}),O.createElement(y.a.Content,null,O.createElement(w,null),O.createElement(z.a,null),O.createElement(j.a.Item,{mode:"android",label:"This rig is OK to jump",onPress:function(){return U(E.a.forms.rigInspection.setOk(!v.ok))},status:v.ok?"checked":"unchecked"})),O.createElement(y.a.Actions,null,O.createElement(h.a,{disabled:!V||JSON.stringify(v.fields)===(null==M||null==(s=M.dropzone)||null==(u=s.rigInspectionTemplate)?void 0:u.definition),mode:"contained",onPress:function(){return X()},loading:H.loading,style:{width:"100%"}},"Mark as inspected")))))}}}]);
//# sourceMappingURL=20.fcdabf6f.chunk.js.map