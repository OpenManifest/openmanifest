{"version":3,"sources":["components/notifications/index.ts","components/forms/extra/ExtraForm.tsx","screens/authenticated/extras/UpdateExtraScreen.tsx"],"names":["actions","slice","Notifications","QUERY_TICKET_TYPES","gql","ExtraForm","state","useAppSelector","forms","extra","dispatch","useAppDispatch","currentDropzone","useCurrentDropzone","data","useQuery","variables","dropzoneId","Number","dropzone","id","style","styles","field","mode","label","error","fields","name","value","onChangeText","newValue","setField","type","cost","toString","width","Subheader","ticketTypes","map","ticket","Item","status","ticketTypeIds","includes","onPress","xor","StyleSheet","create","flex","marginBottom","MUTATION_UPDATE_EXTRA","UpdateExtraScreen","navigation","useNavigation","useRoute","params","React","setOpen","useMutation","mutationUpdateExtra","validate","hasError","length","setFieldError","JSON","stringify","onSave","a","async","original","result","updateExtra","snackbar","showSnackbar","message","variant","goBack","contentContainerStyle","paddingHorizontal","size","color","alignSelf","disabled","loading","container","title","fontSize","fontWeight","separator","marginVertical","height"],"mappings":"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","file":"static/js/15.733ffab2.chunk.js","sourcesContent":["import slice from \"./slice\";\nimport Notifications from \"./Notifications\";\n\nconst { actions } = slice;\n\nexport { actions };\nexport default Notifications;\n","import { useQuery } from '@apollo/client';\nimport gql from 'graphql-tag';\nimport * as React from 'react';\nimport { StyleSheet, View } from 'react-native';\nimport { TextInput, HelperText, Checkbox, List } from 'react-native-paper';\nimport { xor } from \"lodash\";\nimport { Query } from '../../../graphql/schema';\nimport { actions, useAppSelector, useAppDispatch } from '../../../redux';\nimport useCurrentDropzone from '../../../graphql/hooks/useCurrentDropzone';\n\n\nconst QUERY_TICKET_TYPES = gql`\n  query QueryTicketType(\n    $dropzoneId: Int!\n  ) {\n    ticketTypes(dropzoneId: $dropzoneId) {\n      id\n      cost\n      currency\n      name\n      allowManifestingSelf\n\n      extras {\n        id\n        name\n      }\n    }\n  }\n`;\n\nexport default function ExtraForm() {\n  const state = useAppSelector(state => state.forms.extra);\n  const dispatch = useAppDispatch();\n  const currentDropzone = useCurrentDropzone();\n  const { data } = useQuery<Query>(QUERY_TICKET_TYPES, {\n    variables: {\n      dropzoneId: Number(currentDropzone?.dropzone?.id),\n    }\n  });\n\n  return ( \n    <>\n      <TextInput\n        style={styles.field}\n        mode=\"outlined\"\n        label=\"Name\"\n        error={!!state.fields.name.error}\n        value={state.fields.name.value}\n        onChangeText={(newValue) => dispatch(actions.forms.extra.setField([\"name\", newValue]))}\n      />\n      <HelperText type={!!state.fields.name.error ? \"error\" : \"info\"}>\n        { state.fields.name.error || \"\" }\n      </HelperText>\n\n      <TextInput\n        style={styles.field}\n        mode=\"outlined\"\n        label=\"Price\"\n        error={!!state.fields.cost.error}\n        value={state.fields.cost?.value?.toString()}\n        onChangeText={(newValue) => dispatch(actions.forms.extra.setField([\"cost\", Number(newValue)]))}\n      />\n      <HelperText type={!!state.fields.cost.error ? \"error\" : \"info\"}>\n        { state.fields.cost.error || \"\" }\n      </HelperText>\n\n      <View style={{ width: \"100%\"}}>\n        <List.Subheader>\n          Compatible tickets\n        </List.Subheader>\n        {\n          data?.ticketTypes.map((ticket) =>\n            <Checkbox.Item\n              label={ticket.name!}\n              status={state.fields.ticketTypeIds.value.includes(Number(ticket.id))\n                ? \"checked\"\n                : \"unchecked\"\n              }\n              onPress={\n                () => dispatch(actions.forms.extra.setField([\"ticketTypeIds\", xor(state.fields.ticketTypeIds.value, [Number(ticket.id)])]))\n              }\n            />\n          )\n        }\n      </View>\n    </>\n  );\n}\n\nconst styles = StyleSheet.create({\n  fields: {\n    width: \"100%\",\n    flex: 1,\n    \n  },\n  field: {\n    marginBottom: 8,\n    width: \"100%\"\n  }\n});\n","import * as React from 'react';\nimport { StyleSheet } from 'react-native';\nimport { Button } from 'react-native-paper';\nimport { gql, useMutation } from \"@apollo/client\";\nimport { actions, useAppSelector, useAppDispatch } from '../../../redux';\n\nimport { View } from '../../../components/Themed';\nimport { actions as snackbar } from \"../../../components/notifications\";\nimport globalSlice from \"../../../redux/global\";\n\nimport slice from \"../../../components/forms/extra/slice\";\nimport { Mutation, Extra } from '../../../graphql/schema';\nimport ExtraForm from '../../../components/forms/extra/ExtraForm';\nimport { useNavigation, useRoute } from '@react-navigation/core';\nimport ScrollableScreen from '../../../components/layout/ScrollableScreen';\nimport { MaterialCommunityIcons } from '@expo/vector-icons';\nimport useCurrentDropzone from '../../../graphql/hooks/useCurrentDropzone';\n\n\nconst MUTATION_UPDATE_EXTRA = gql`\n  mutation UpdateExtra(\n    $id: Int!,\n    $name: String,\n    $ticketTypeIds: [Int!]\n    $cost: Float\n    $dropzoneId: Int\n  ){\n    updateExtra(input: {\n      id: $id\n      attributes: {\n        name: $name,\n        ticketTypeIds: $ticketTypeIds\n        cost: $cost\n        dropzoneId: $dropzoneId\n      }\n    }) {\n      extra {\n        id\n        name\n\n        ticketTypes {\n          id\n          name\n          cost\n          altitude\n          allowManifestingSelf\n        }\n      }\n    }\n  }\n`;\n\nexport default function UpdateExtraScreen() {\n  const currentDropzone = useCurrentDropzone();\n  const state = useAppSelector(state => state.forms.extra);\n  const dispatch = useAppDispatch();\n\n  const navigation = useNavigation();\n  const route = useRoute<{ key: string, name: string, params: { extra: Extra }}>();\n  const extra = route.params!.extra;\n\n  React.useEffect(() => {\n    dispatch(actions.forms.extra.setOpen(extra));\n  }, [extra?.id]);\n\n  const [mutationUpdateExtra, data] = useMutation<Mutation>(MUTATION_UPDATE_EXTRA);\n\n  const validate = React.useCallback((): boolean => {\n    let hasError = false;\n    if (state.fields.name.value.length < 3) {\n      hasError = true;\n      dispatch(\n        actions.forms.extra.setFieldError([\"name\", \"Name is too short\"])\n      );\n    }\n\n    if (Number(state.fields.cost.value) < 0) {\n      hasError = true;\n      dispatch(\n        actions.forms.extra.setFieldError([\"cost\", \"Price must be a number\"])\n      );\n    }\n\n\n    return !hasError;\n\n  }, [JSON.stringify(state.fields), dispatch]);\n\n  const onSave = React.useCallback(async () => {\n    const { name, cost, ticketTypeIds } = state.fields;\n\n\n    if (validate()) {\n      try {\n        const result = await mutationUpdateExtra({\n          variables: {\n            id: Number(state.original!.id!),\n            dropzoneId: Number(currentDropzone?.dropzone?.id),\n            name: name.value,\n            cost: cost.value,\n            ticketTypeIds: ticketTypeIds.value,\n          }\n        });\n        \n        if (result.data?.updateExtra?.extra) {\n          dispatch(\n            snackbar.showSnackbar({ message: `Saved`, variant: \"success\" })\n          );\n          navigation.goBack();\n        }\n      } catch (error) {\n        dispatch(\n          snackbar.showSnackbar({ message: error.message, variant: \"error\" })\n        );\n      }\n    }\n    \n  }, [JSON.stringify(state.fields), dispatch, mutationUpdateExtra]);\n\n  return (\n    <ScrollableScreen contentContainerStyle={{ paddingHorizontal: 48 }}>\n        <MaterialCommunityIcons name=\"ticket-percent\" size={100} color=\"#999999\" style={{ alignSelf: \"center\" }} />\n        <ExtraForm />\n        <View style={styles.fields}>\n          <Button mode=\"contained\" disabled={data.loading} onPress={onSave} loading={data.loading}>\n            Save\n          </Button>\n      </View>\n    </ScrollableScreen>\n  );\n}\n\nconst styles = StyleSheet.create({\n  container: {\n    flex: 1,\n  },\n  title: {\n    fontSize: 20,\n    fontWeight: 'bold',\n  },\n  separator: {\n    marginVertical: 30,\n    height: 1,\n    width: '80%',\n  },\n  fields: {\n    width: \"100%\",\n    marginBottom: 16\n  },\n  field: {\n    marginBottom: 8,\n  }\n});\n"],"sourceRoot":""}