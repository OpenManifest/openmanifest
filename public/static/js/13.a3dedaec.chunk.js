(this.webpackJsonp=this.webpackJsonp||[]).push([[13],{532:function(e,n,r){"use strict";var t=r(533),a=r(0),l=r(2),o=r(317);n.a=function(e){var n=e.items,r=e.selected,i=e.isSelected,s=e.isDisabled,u=e.icon,d=e.renderItemLabel,c=e.onChangeSelected,m=e.autoSelectFirst;return a.useEffect((function(){(!r||!r.length&&n.length&&m)&&c([n[0]])}),[JSON.stringify(r),JSON.stringify(n),m]),a.createElement(l.a,{style:{flexDirection:"row",flexWrap:"wrap"}},n.map((function(e){return a.createElement(o.a,{key:JSON.stringify(e),mode:"outlined",icon:!r.some((function(n){return Object(t.isEqual)(e,n)}))&&u?u:void 0,style:{margin:1},disabled:s(e),selected:i?i(e):r.some((function(n){return Object(t.isEqual)(e,n)})),onPress:function(){return c(1===r.length?[e]:Object(t.xorBy)(r,[e],JSON.stringify))}},d(e))})))}},536:function(e,n,r){"use strict";r.d(n,"a",(function(){return l}));var t=r(130),a=r(278),l=t.a.actions;a.a},537:function(e,n,r){"use strict";r.d(n,"a",(function(){return o}));var t=r(49),a=r(0),l=r(19);function o(e,n){var r=n.getPayload;return function(n){var o=n.variables,i=n.onError,s=Object(l.b)(),u=Object(t.useQuery)(e,{variables:o}),d=u.data,c=u.loading,m=u.previousData,f=u.refetch,p=u.error,v=a.useMemo((function(){return r(d)}),[JSON.stringify(d)]);return a.useEffect((function(){JSON.stringify(m),JSON.stringify(d);null!=p&&p.message&&(!1!==n.showSnackbarErrors&&s(l.a.notifications.showSnackbar({message:p.message,variant:"error"})),i&&p.message)}),[n.onError,null==p?void 0:p.message]),{loading:c,data:v,refetch:f}}}},574:function(e,n,r){"use strict";r.d(n,"a",(function(){return $}));var t,a=r(0),l=r(1),o=r(2),i=r(266),s=r(238),u=r(318),d=r(240),c=r(19),m=r(11),f=r.n(m),p=r(56),v=r(276),g=r(57),b=r.n(g),S=r(58),E=r(537),h=Object(S.a)(t||(t=b()(["\nquery QueryDropzoneUsers(\n  $dropzoneId: Int!\n  $permissions: [Permission!]\n) {\n  dropzone(id: $dropzoneId) {\n    id\n    name\n\n    dropzoneUsers(permissions: $permissions) {\n      edges {\n        node {\n          id\n          role {\n            id\n            name\n          }\n          user {\n            id\n            name\n          }\n        }\n      }\n    }\n  }\n}\n"]))),O=Object(E.a)(h,{getPayload:function(e){var n;return null==e||null==(n=e.dropzone)?void 0:n.dropzoneUsers}}),y=r(532);function x(e){var n,r,t=e.label,l=e.requiredPermissions,o=e.icon,i=(e.required,e.value),s=Object(v.a)(),u=Object(c.b)(),d=O({variables:{dropzoneId:Number(null==s||null==(n=s.dropzone)?void 0:n.id),permissions:l},onError:function(e){return u(c.a.notifications.showSnackbar({message:e,variant:"error"}))}}),m=d.data;d.loading,d.refetch;return a.createElement(a.Fragment,null,a.createElement(p.b.Subheader,null,t),a.createElement(y.a,{autoSelectFirst:!0,icon:o||"account",items:(null==m||null==(r=m.edges)?void 0:r.map((function(e){return e.node})))||[],selected:[e.value].filter(Boolean),isSelected:function(e){return e.id===(null==i?void 0:i.id)},renderItemLabel:function(e){return null==e?void 0:e.user.name},isDisabled:function(){return!1},onChangeSelected:function(n){var r=f()(n,1)[0];return r?e.onSelect(r):null}}))}var I,j=r(22),F=r.n(j),w=r(49),z=r(533),k=Object(S.a)(I||(I=b()(["\n  query QueryPlanes(\n    $dropzoneId: Int!\n  ) {\n    planes(dropzoneId: $dropzoneId) {\n      id\n      name\n      registration\n      hours\n      minSlots\n      maxSlots\n      nextMaintenanceHours\n      createdAt\n    }\n  }\n"])));function N(e){var n,r=Object(v.a)(),t=Object(w.useQuery)(k,{variables:{dropzoneId:Number(null==(n=r.dropzone)?void 0:n.id)}}),l=t.data;t.loading,t.refetch;return a.createElement(a.Fragment,null,a.createElement(p.b.Subheader,null,"Aircraft"),a.createElement(y.a,{autoSelectFirst:!0,items:Object(z.uniqBy)(F()((null==l?void 0:l.planes)||[]),(function(e){return e.id}))||[],selected:[e.value].filter(Boolean),renderItemLabel:function(e){return null==e?void 0:e.name},isDisabled:function(e){return!1},onChangeSelected:function(n){var r=f()(n,1)[0];return r?e.onSelect(r):null}}))}function $(){var e,n,r=Object(c.c)((function(e){return e.forms.load})),t=Object(c.b)();Object(c.c)((function(e){return e.global}));return a.createElement(a.Fragment,null,a.createElement(i.a,{style:P.field,mode:"outlined",label:"Name",error:!!r.fields.name.error,placeholder:"Optional",value:r.fields.name.value||"",autoFocus:!0,onChangeText:function(e){return t(c.a.forms.load.setField(["name",e]))}}),a.createElement(s.a,{type:r.fields.name.error?"error":"info"},r.fields.name.error||"e.g Starcrest load, Tandem load"),a.createElement(i.a,{style:P.field,mode:"outlined",label:"Slots",error:!!r.fields.maxSlots.error,value:null==(e=r.fields.maxSlots)||null==(n=e.value)?void 0:n.toString(),onChangeText:function(e){return t(c.a.forms.load.setField(["maxSlots",Number(e)]))}}),a.createElement(s.a,{type:r.fields.maxSlots.error?"error":"info"},r.fields.maxSlots.error||""),a.createElement(o.a,{style:{width:"100%"}},a.createElement(N,{value:r.fields.plane.value,required:!0,onSelect:function(e){t(c.a.forms.load.setField(["plane",e])),t(c.a.forms.load.setField(["maxSlots",e.maxSlots]))}}),a.createElement(s.a,{type:r.fields.plane.error?"error":"info"},r.fields.plane.error||""),a.createElement(x,{label:"GCA",onSelect:function(e){return t(c.a.forms.load.setField(["gca",e]))},value:r.fields.gca.value||null,requiredPermissions:["actAsGCA"],required:!0}),a.createElement(s.a,{type:r.fields.gca.error?"error":"info"},r.fields.gca.error||""),a.createElement(x,{label:"Pilot",onSelect:function(e){return t(c.a.forms.load.setField(["pilot",e]))},value:r.fields.pilot.value||null,requiredPermissions:["actAsPilot"]}),a.createElement(s.a,{type:r.fields.pilot.error?"error":"info"},r.fields.pilot.error||""),a.createElement(u.a,{style:{marginVertical:8}}),a.createElement(d.a.Item,{label:"Allow public manifesting",status:r.fields.isOpen.value?"checked":"unchecked",onPress:function(){return t(c.a.forms.load.setField(["isOpen",!r.fields.isOpen.value]))}})))}var P=l.a.create({fields:{flex:1,width:"100%"},field:{marginBottom:8,width:"100%"}})},696:function(e,n,r){"use strict";r.r(n),r.d(n,"default",(function(){return j}));var t,a=r(11),l=r.n(a),o=r(57),i=r.n(o),s=r(6),u=r.n(s),d=r(0),c=r(1),m=r(125),f=r(49),p=r(19),v=r(50),g=r(82),b=r(536),S=r(262),E=r(574),h=r(181),O=r(366),y=r(276),x=S.a.actions,I=Object(f.gql)(t||(t=i()(["\n  mutation CreateLoad(\n    $name: String,\n    $pilotId: Int,\n    $gcaId: Int,\n    $maxSlots: Int!,\n    $planeId: Int,\n    $isOpen: Boolean,\n  ){\n    createLoad(input: {\n      attributes: {\n        name: $name,\n        pilotId: $pilotId,\n        gcaId: $gcaId,\n        maxSlots: $maxSlots,\n        planeId: $planeId,\n        isOpen: $isOpen,\n      }\n    }) {\n      load {\n        id\n        name\n        pilot {\n          id\n          user {\n            id \n            name\n          }\n        }\n        gca {\n          id\n          user {\n            id \n            name\n          }\n        }\n        maxSlots\n        isOpen\n      }\n      fieldErrors {\n        field,\n        message\n      }\n      errors\n    }\n  }\n"])));function j(){var e=Object(y.a)(),n=Object(p.c)((function(e){return e.forms.load})),r=Object(p.b)(),t=Object(v.useNavigation)(),a=Object(f.useMutation)(I),o=l()(a,2),i=o[0],s=o[1],c=d.useCallback((function(){var e=!1;return n.fields.maxSlots.value<1&&(e=!0,r(x.setFieldError(["maxSlots","Please specify amount of allowed jumpers"]))),n.fields.plane.value||(e=!0,r(x.setFieldError(["plane","What plane is flying this load?"]))),n.fields.gca.value||(e=!0,r(x.setFieldError(["gca","You must have a GCA for this load"]))),!e}),[JSON.stringify(n.fields),r]),S=d.useCallback((function(){var a,l,o,s,d,m,f,p,v,g,S,E,h,O,y,I,j,F,w,z,k,N,$,P,q,C,L,J;return u.a.async((function(A){for(;;)switch(A.prev=A.next){case 0:if(a=n.fields,l=a.name,o=a.gca,a.loadMaster,s=a.plane,d=a.maxSlots,m=a.pilot,f=a.isOpen,!c()){A.next=15;break}return A.prev=2,A.next=5,u.a.awrap(i({variables:{dropzoneId:Number(null==e||null==(p=e.dropzone)?void 0:p.id),name:l.value,maxSlots:d.value,planeId:null!=(v=s.value)&&v.id?Number(null==(g=s.value)?void 0:g.id):null,pilotId:null!=(S=m.value)&&S.id?Number(null==(E=s.value)?void 0:E.id):null,gcaId:null!=(h=o.value)&&null!=(O=h.user)&&O.id?Number(null==(y=o.value)||null==(I=y.user)?void 0:I.id):null,isOpen:!!f.value}}));case 5:if(q=A.sent,null==(j=q.data)||null==(F=j.createLoad)||null==(w=F.fieldErrors)||w.map((function(e){var n=e.field,t=e.message;switch(n){case"name":return r(x.setFieldError(["name",t]));case"maxSlots":return r(x.setFieldError(["maxSlots",t]));case"plane":return r(x.setFieldError(["plane",t]));case"gca":return r(x.setFieldError(["gca",t]));case"is_open":return r(x.setFieldError(["isOpen",t]));case"pilot":return r(x.setFieldError(["pilot",t]))}})),null==q||null==(z=q.data)||null==(k=z.createLoad)||null==(N=k.errors)||!N.length){A.next=9;break}return A.abrupt("return",r(b.a.showSnackbar({message:q.data.createLoad.errors[0],variant:"error"})));case 9:null!=($=q.data)&&null!=(P=$.createLoad)&&P.load&&(J=q.data.createLoad.load,r(b.a.showSnackbar({message:"Load "+J.name+" created",variant:"success"})),null!=(C=q.data)&&null!=(L=C.createLoad)&&L.fieldErrors||t.goBack()),A.next=15;break;case 12:A.prev=12,A.t0=A.catch(2),r(b.a.showSnackbar({message:A.t0.message,variant:"error"}));case 15:case"end":return A.stop()}}),null,null,[[2,12]],Promise)}),[JSON.stringify(n.fields),r,i]);return d.createElement(h.a,{contentContainerStyle:F.content},d.createElement(O.a,{name:"airplane-takeoff",size:100,color:"#999999",style:{alignSelf:"center",marginTop:32}}),d.createElement(E.a,null),d.createElement(g.b,{style:F.fields},d.createElement(m.a,{mode:"contained",style:F.button,disabled:s.loading,onPress:S,loading:s.loading},"Save")))}var F=c.a.create({content:{paddingHorizontal:48},button:{},title:{fontSize:20,fontWeight:"bold"},separator:{marginVertical:30,height:1,width:"80%"},fields:{marginVertical:16,width:"100%"},field:{marginBottom:8}})}}]);
//# sourceMappingURL=13.a3dedaec.chunk.js.map